<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>냥쿤OS 관리자</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
}

body {
font-family: 'Press Start 2P', monospace;
background: #0a0a0a;
color: #4ade80;
min-height: 100vh;
image-rendering: pixelated;
overflow-x: hidden;
}

.back-button {
position: fixed;
top: 20px;
left: 20px;
z-index: 1000;
background: rgba(0, 0, 0, 0.8);
border: 2px solid #4ade80;
color: #4ade80;
padding: 8px 12px;
font-size: 8px;
cursor: pointer;
font-family: 'Press Start 2P', monospace;
transition: all 0.2s;
box-shadow: 0 0 5px rgba(74, 222, 128, 0.2);
}

.back-button:hover {
background: #4ade80;
color: #000000;
transform: scale(1.05);
box-shadow: 0 0 10px rgba(74, 222, 128, 0.4);
}

.admin-container {
background: 
  radial-gradient(circle at 25% 25%, rgba(74, 222, 128, 0.03) 0%, transparent 50%),
  radial-gradient(circle at 75% 75%, rgba(245, 158, 11, 0.03) 0%, transparent 50%),
  repeating-linear-gradient(90deg, transparent, transparent 2px, rgba(74, 222, 128, 0.01) 2px, rgba(74, 222, 128, 0.01) 4px);
min-height: 100vh;
padding: 20px;
padding-top: 70px;
}

.admin-header {
background: linear-gradient(90deg, #111 0%, #1a1a1a 50%, #111 100%);
border: 2px solid #4ade80;
padding: 16px;
margin-bottom: 24px;
text-align: center;
box-shadow: 0 0 20px rgba(74, 222, 128, 0.3), inset 0 0 20px rgba(74, 222, 128, 0.05);
display: flex;
justify-content: space-between;
align-items: center;
}

.admin-title {
font-size: 14px;
color: #4ade80;
text-shadow: 0 0 10px rgba(74, 222, 128, 0.5);
margin-bottom: 8px;
}

.admin-subtitle {
font-size: 8px;
color: rgba(74, 222, 128, 0.7);
}

.logout-btn {
background: rgba(239, 68, 68, 0.2);
border: 2px solid #ef4444;
color: #fca5a5;
padding: 8px 12px;
font-size: 7px;
cursor: pointer;
font-family: 'Press Start 2P', monospace;
transition: all 0.2s;
box-shadow: 0 0 5px rgba(239, 68, 68, 0.2);
}

.logout-btn:hover {
background: #ef4444;
color: #000000;
transform: scale(1.05);
box-shadow: 0 0 10px rgba(239, 68, 68, 0.4);
}

.admin-grid {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
gap: 24px;
max-width: 1200px;
margin: 0 auto;
}

.admin-section {
background: rgba(0, 0, 0, 0.8);
border: 2px solid #4ade80;
padding: 20px;
box-shadow: 0 0 15px rgba(74, 222, 128, 0.2), inset 0 0 15px rgba(74, 222, 128, 0.05);
}

.section-header {
display: flex;
align-items: center;
gap: 8px;
margin-bottom: 16px;
padding-bottom: 8px;
border-bottom: 1px solid rgba(74, 222, 128, 0.3);
}

.section-title {
font-size: 10px;
color: #86efac;
text-shadow: 0 0 5px rgba(134, 239, 172, 0.3);
}

.form-group {
margin-bottom: 16px;
}

.form-label {
display: block;
font-size: 7px;
color: #4ade80;
margin-bottom: 6px;
text-transform: uppercase;
}

.form-input {
width: 100%;
background: rgba(0, 0, 0, 0.8);
border: 2px solid #4ade80;
color: #86efac;
padding: 8px 12px;
font-family: 'Press Start 2P', monospace;
font-size: 7px;
outline: none;
transition: all 0.2s;
box-shadow: 0 0 5px rgba(74, 222, 128, 0.2);
}

.form-input:focus {
border-color: #f59e0b;
color: #fbbf24;
box-shadow: 0 0 10px rgba(245, 158, 11, 0.3);
}

.form-input::placeholder {
color: rgba(74, 222, 128, 0.4);
}

.form-textarea {
min-height: 80px;
resize: vertical;
line-height: 1.4;
}

.form-btn {
background: rgba(0, 0, 0, 0.8);
border: 2px solid #4ade80;
color: #4ade80;
padding: 8px 16px;
font-size: 7px;
cursor: pointer;
font-family: 'Press Start 2P', monospace;
transition: all 0.2s;
box-shadow: 0 0 5px rgba(74, 222, 128, 0.2);
margin-right: 8px;
margin-bottom: 8px;
}

.form-btn:hover {
background: #4ade80;
color: #000000;
transform: scale(1.05);
box-shadow: 0 0 10px rgba(74, 222, 128, 0.4);
}

.form-btn.danger {
border-color: #ef4444;
color: #ef4444;
}

.form-btn.danger:hover {
background: #ef4444;
color: #000000;
}

.form-btn.warning {
border-color: #f59e0b;
color: #f59e0b;
}

.form-btn.warning:hover {
background: #f59e0b;
color: #000000;
}

.items-list {
max-height: 300px;
overflow-y: auto;
margin-top: 16px;
}

.items-list::-webkit-scrollbar {
width: 6px;
}

.items-list::-webkit-scrollbar-track {
background: rgba(74, 222, 128, 0.1);
}

.items-list::-webkit-scrollbar-thumb {
background: #4ade80;
box-shadow: 0 0 3px rgba(74, 222, 128, 0.3);
}

.list-item {
background: rgba(74, 222, 128, 0.05);
border: 1px solid rgba(74, 222, 128, 0.2);
padding: 12px;
margin-bottom: 8px;
transition: all 0.2s;
}

.list-item:hover {
background: rgba(74, 222, 128, 0.1);
border-color: rgba(74, 222, 128, 0.4);
}

.item-title {
font-size: 8px;
color: #86efac;
margin-bottom: 4px;
}

.item-content {
font-size: 6px;
color: rgba(74, 222, 128, 0.8);
line-height: 1.3;
margin-bottom: 6px;
word-break: break-all;
}

.item-meta {
font-size: 5px;
color: rgba(147, 51, 234, 0.8);
margin-bottom: 8px;
}

.item-actions {
display: flex;
gap: 6px;
}

.status-indicator {
position: fixed;
top: 20px;
right: 20px;
background: rgba(0, 0, 0, 0.9);
border: 2px solid #4ade80;
padding: 8px 12px;
font-size: 6px;
color: #4ade80;
box-shadow: 0 0 10px rgba(74, 222, 128, 0.3);
z-index: 1000;
}

.status-indicator.success {
border-color: #22c55e;
color: #22c55e;
}

.status-indicator.error {
border-color: #ef4444;
color: #ef4444;
}

.loading {
text-align: center;
color: rgba(74, 222, 128, 0.6);
font-size: 7px;
padding: 20px;
}

.photo-preview {
width: 60px;
height: 60px;
object-fit: cover;
border: 1px solid rgba(74, 222, 128, 0.3);
margin-right: 8px;
display: inline-block;
}

.app-grid {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
gap: 12px;
margin-bottom: 16px;
}

.app-btn {
background: rgba(0, 0, 0, 0.8);
border: 2px solid #4ade80;
color: #4ade80;
padding: 12px 8px;
font-size: 6px;
cursor: pointer;
font-family: 'Press Start 2P', monospace;
transition: all 0.2s;
box-shadow: 0 0 5px rgba(74, 222, 128, 0.2);
text-align: center;
}

.app-btn:hover {
background: #4ade80;
color: #000000;
transform: scale(1.02);
box-shadow: 0 0 10px rgba(74, 222, 128, 0.4);
}

@media (max-width: 768px) {
.admin-grid {
  grid-template-columns: 1fr;
  gap: 16px;
}

.admin-container {
  padding: 10px;
  padding-top: 70px;
}

.admin-section {
  padding: 16px;
}
}
</style>
</head>
<body>

<button class="back-button" onclick="window.history.back()">← 뒤로가기</button>

<div class="admin-container">
<div class="status-indicator" id="status-indicator">시스템 준비완료</div>

<div class="admin-header">
<div>
  <div class="admin-title">📂 냥쿤OS 관리자 페이지</div>
  <div class="admin-subtitle">Blob 데이터 관리 시스템</div>
</div>
<button class="logout-btn" onclick="logout()">🚪 로그아웃</button>
</div>

<div class="admin-grid">
<div class="admin-section">
  <div class="section-header">
    <div class="section-title">💬 챗봇 대화 로그</div>
  </div>
  <div class="form-group">
    <button class="form-btn" onclick="loadChatLogs()">🔄 로그 새로고침</button>
    <button class="form-btn danger" onclick="clearChatLogs()">🗑️ 로그 삭제</button>
    <button class="form-btn" onclick="exportChatLogs()">📤 로그 내보내기</button>
  </div>
  <div class="items-list" id="chat-logs-list"></div>
</div>

<div class="admin-section">
  <div class="section-header">
    <div class="section-title">📅 연애 타임라인 관리</div>
  </div>
  <form id="timeline-form">
    <div class="form-group">
      <label class="form-label">날짜</label>
      <input type="text" class="form-input" id="timeline-date" placeholder="2024.03.11" required />
    </div>
    <div class="form-group">
      <label class="form-label">제목</label>
      <input type="text" class="form-input" id="timeline-title" placeholder="첫 만남" required />
    </div>
    <div class="form-group">
      <label class="form-label">내용</label>
      <textarea class="form-input form-textarea" id="timeline-content" placeholder="특별한 순간의 이야기를 적어보세요..."></textarea>
    </div>
    <div class="form-group">
      <label class="form-label">위치</label>
      <input type="text" class="form-input" id="timeline-position" placeholder="50%" required />
    </div>
    <button type="submit" class="form-btn">추가</button>
  </form>
  <div class="items-list" id="timeline-list"></div>
</div>

<div class="admin-section">
  <div class="section-header">
    <div class="section-title">📸 사진 업로드</div>
  </div>
  <form id="photo-form">
    <div class="form-group">
      <label class="form-label">사진 파일</label>
      <input type="file" class="form-input" id="photo-file" accept="image/*" required />
    </div>
    <div class="form-group">
      <label class="form-label">사진 제목</label>
      <input type="text" class="form-input" id="photo-title" placeholder="우리의 추억" required />
    </div>
    <div class="form-group">
      <label class="form-label">설명</label>
      <input type="text" class="form-input" id="photo-description" placeholder="짧은 설명" />
    </div>
    <div class="form-group">
      <label class="form-label">날짜</label>
      <input type="text" class="form-input" id="photo-date" placeholder="2024.04.01" required />
    </div>
    <button type="submit" class="form-btn">사진 추가</button>
  </form>
  <div class="items-list" id="photo-list"></div>
</div>

<div class="admin-section">
  <div class="section-header">
    <div class="section-title">💌 냥쿤에게 쓰는 편지</div>
  </div>
  <form id="letter-to-form">
    <div class="form-group">
      <label class="form-label">제목</label>
      <input type="text" class="form-input" id="letter-to-title" placeholder="사랑하는 냥쿤에게" required />
    </div>
    <div class="form-group">
      <label class="form-label">내용</label>
      <textarea class="form-input form-textarea" id="letter-to-content" placeholder="냥쿤에게 전하고 싶은 마음을 써보세요..." required></textarea>
    </div>
    <button type="submit" class="form-btn">편지 작성</button>
  </form>
  <div class="items-list" id="letter-to-list"></div>
</div>

<div class="admin-section">
  <div class="section-header">
    <div class="section-title">📨 냥쿤이 나에게 쓴 편지</div>
  </div>
  <form id="letter-from-form">
    <div class="form-group">
      <label class="form-label">작성자</label>
      <input type="text" class="form-input" id="letter-from-name" placeholder="냥쿤" value="냥쿤" required />
    </div>
    <div class="form-group">
      <label class="form-label">편지 내용</label>
      <textarea class="form-input form-textarea" id="letter-from-content" placeholder="냥쿤이 보내는 편지 내용..." required></textarea>
    </div>
    <button type="submit" class="form-btn">편지 추가</button>
  </form>
  <div class="items-list" id="letter-from-list"></div>
</div>

<div class="admin-section">
  <div class="section-header">
    <div class="section-title">⚙️ 시스템 관리</div>
  </div>
  <div class="app-grid">
    <button class="app-btn" onclick="manageApp('timeline')">📅 타임라인 초기화</button>
    <button class="app-btn" onclick="manageApp('photos')">📸 사진 초기화</button>
    <button class="app-btn" onclick="manageApp('letters')">💌 편지 초기화</button>
    <button class="app-btn" onclick="exportData()">📤 데이터 내보내기</button>
    <button class="app-btn" onclick="loadLocalData()">☁️ 클라우드에서 불러오기</button>
    <button class="app-btn" onclick="importData()">📥 데이터 가져오기</button>
  </div>
  <div class="form-group">
    <label class="form-label">데이터 가져오기</label>
    <input type="file" class="form-input" id="import-file" accept=".json" />
  </div>
</div>
</div>
</div>

<script>
const auth = localStorage.getItem('nyangkun_auth');
const authTime = localStorage.getItem('nyangkun_auth_time');

if (!auth || auth !== 'authenticated') {
  window.location.href = './login.html';
} else {
  const timeDiff = Date.now() - parseInt(authTime || '0');
  const hoursDiff = timeDiff / (1000 * 60 * 60);
  
  if (hoursDiff > 24) {
    localStorage.removeItem('nyangkun_auth');
    localStorage.removeItem('nyangkun_auth_time');
    window.location.href = './login.html';
  }
}

let localData = {
  timeline: [],
  photos: [],
  lettersTo: [],
  lettersFrom: [],
  chatLogs: []
};

function logout() {
  if (confirm('정말 로그아웃 하시겠습니까?')) {
    localStorage.removeItem('nyangkun_auth');
    localStorage.removeItem('nyangkun_auth_time');
    window.location.href = './login.html';
  }
}

async function saveToBlob() {
  try {
    const filename = `nyangkun-data-${Date.now()}.json`;
    
    const response = await fetch(`/api/data/upload?filename=${filename}`, {
      method: 'POST',
      body: JSON.stringify(localData),
      headers: {
        'Content-Type': 'application/json'
      }
    });
    
    const result = await response.json();
    console.log('Data saved to blob:', result);
    return true;
  } catch (error) {
    console.error('Save failed:', error);
    return false;
  }
}

function loadLocalData() {
  showStatus('클라우드에서 로딩중...', 'info');
  
  fetch('/api/data/load')
    .then(response => {
      if (!response.ok) {
        throw new Error('No data found');
      }
      return response.json();
    })
    .then(data => {
      localData = { ...localData, ...data };
      renderAll();
      showStatus('클라우드에서 로딩 완료', 'success');
    })
    .catch(error => {
      console.error('Load failed:', error);
      showStatus('클라우드 로딩 실패', 'error');
    });
}

function loadChatLogs() {
  showStatus('챗봇 로그 로딩중...', 'info');
  
  fetch('/api/data/load')
    .then(response => {
      if (!response.ok) {
        throw new Error('No chat logs found');
      }
      return response.json();
    })
    .then(data => {
      if (data.chatLogs) {
        localData.chatLogs = data.chatLogs;
        renderChatLogs();
        showStatus(`챗봇 로그 ${data.chatLogs.length}개 로딩 완료`, 'success');
      } else {
        localData.chatLogs = [];
        renderChatLogs();
        showStatus('저장된 챗봇 로그가 없습니다', 'info');
      }
    })
    .catch(error => {
      console.error('Chat logs loading failed:', error);
      localData.chatLogs = [];
      renderChatLogs();
      showStatus('챗봇 로그 로딩 실패', 'error');
    });
}

function showStatus(message, type = 'info') {
  const indicator = document.getElementById('status-indicator');
  if (indicator) {
    indicator.textContent = message;
    indicator.className = `status-indicator ${type}`;
    
    setTimeout(() => {
      indicator.className = 'status-indicator';
      indicator.textContent = '시스템 준비완료';
    }, 3000);
  }
}

function generateId() {
  return Date.now().toString(36) + Math.random().toString(36).substr(2);
}

function getCurrentTimestamp() {
  return new Date().toLocaleString('ko-KR');
}

function renderChatLogs() {
  const list = document.getElementById('chat-logs-list');
  if (!list) return;
  
  if (localData.chatLogs.length === 0) {
    list.innerHTML = '<div class="loading">대화 로그가 없습니다.</div>';
    return;
  }
  
  list.innerHTML = localData.chatLogs.map(item => `
    <div class="list-item">
      <div class="item-title">${item.sender === 'user' ? '👤 사용자' : '🤖 냥GPT'}</div>
      <div class="item-content">${item.message.substring(0, 200)}${item.message.length > 200 ? '...' : ''}</div>
      <div class="item-meta">${item.timestamp}</div>
      <div class="item-actions">
        <button class="form-btn warning" onclick="viewFullMessage('${item.id}')">전체보기</button>
        <button class="form-btn danger" onclick="deleteChatLog('${item.id}')">삭제</button>
      </div>
    </div>
  `).join('');
}

function clearChatLogs() {
  if (!confirm('모든 챗봇 대화 로그를 삭제하시겠습니까?')) return;
  
  localData.chatLogs = [];
  saveToBlob();
  renderChatLogs();
  showStatus('챗봇 로그가 삭제되었습니다', 'success');
}

function exportChatLogs() {
  if (localData.chatLogs.length === 0) {
    showStatus('내보낼 로그가 없습니다', 'error');
    return;
  }
  
  const logsStr = JSON.stringify(localData.chatLogs, null, 2);
  const blob = new Blob([logsStr], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  
  const a = document.createElement('a');
  a.href = url;
  a.download = `nyangkun-chat-logs-${new Date().toISOString().split('T')[0]}.json`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
  
  showStatus('챗봇 로그가 내보내기되었습니다', 'success');
}

function viewFullMessage(id) {
  const logItem = localData.chatLogs.find(item => item.id === id);
  if (logItem) {
    alert(`[${logItem.sender === 'user' ? '사용자' : '냥GPT'}] ${logItem.timestamp}\n\n${logItem.message}`);
  }
}

function deleteChatLog(id) {
  if (!confirm('이 대화 로그를 삭제하시겠습니까?')) return;
  
  localData.chatLogs = localData.chatLogs.filter(item => item.id !== id);
  saveToBlob();
  renderChatLogs();
  showStatus('대화 로그가 삭제되었습니다', 'success');
}

function renderTimeline() {
  const list = document.getElementById('timeline-list');
  if (!list) return;
  
  if (localData.timeline.length === 0) {
    list.innerHTML = '<div class="loading">등록된 타임라인이 없습니다.</div>';
    return;
  }
  
  list.innerHTML = localData.timeline.map(item => `
    <div class="list-item">
      <div class="item-title">${item.date} - ${item.title}</div>
      <div class="item-content">${item.content}</div>
      <div class="item-meta">위치: ${item.position}</div>
      <div class="item-actions">
        <button class="form-btn danger" onclick="deleteTimeline('${item.id}')">삭제</button>
      </div>
    </div>
  `).join('');
}

function renderPhotos() {
  const list = document.getElementById('photo-list');
  if (!list) return;
  
  if (localData.photos.length === 0) {
    list.innerHTML = '<div class="loading">등록된 사진이 없습니다.</div>';
    return;
  }
  
  list.innerHTML = localData.photos.map(item => `
    <div class="list-item">
      <img src="${item.url}" class="photo-preview" alt="${item.title}">
      <div style="display: inline-block; vertical-align: top;">
        <div class="item-title">${item.title}</div>
        <div class="item-content">${item.description}</div>
        <div class="item-meta">${item.date}</div>
        <div class="item-actions">
          <button class="form-btn danger" onclick="deletePhoto('${item.id}')">삭제</button>
        </div>
      </div>
    </div>
  `).join('');
}

function renderLettersTo() {
  const list = document.getElementById('letter-to-list');
  if (!list) return;
  
  if (localData.lettersTo.length === 0) {
    list.innerHTML = '<div class="loading">작성된 편지가 없습니다.</div>';
    return;
  }
  
  list.innerHTML = localData.lettersTo.map(item => `
    <div class="list-item">
      <div class="item-title">${item.title}</div>
      <div class="item-content">${item.content.substring(0, 100)}...</div>
      <div class="item-meta">${item.timestamp}</div>
      <div class="item-actions">
        <button class="form-btn danger" onclick="deleteLetterTo('${item.id}')">삭제</button>
      </div>
    </div>
  `).join('');
}

function renderLettersFrom() {
  const list = document.getElementById('letter-from-list');
  if (!list) return;
  
  if (localData.lettersFrom.length === 0) {
    list.innerHTML = '<div class="loading">받은 편지가 없습니다.</div>';
    return;
  }
  
  list.innerHTML = localData.lettersFrom.map(item => `
    <div class="list-item">
      <div class="item-title">${item.name}로부터</div>
      <div class="item-content">${item.message.substring(0, 100)}...</div>
      <div class="item-meta">${item.timestamp}</div>
      <div class="item-actions">
        <button class="form-btn danger" onclick="deleteLetterFrom('${item.id}')">삭제</button>
      </div>
    </div>
  `).join('');
}

function renderAll() {
  renderTimeline();
  renderPhotos();
  renderLettersTo();
  renderLettersFrom();
  renderChatLogs();
}

async function uploadToVercelBlob(file) {
  const formData = new FormData();
  formData.append('file', file);
  
  const response = await fetch('/api/upload', {
    method: 'POST',
    body: formData
  });
  
  if (!response.ok) {
    throw new Error('파일 업로드 실패');
  }
  
  const result = await response.json();
  return result.url;
}

function deleteTimeline(id) {
  if (!confirm('정말 삭제하시겠습니까?')) return;
  localData.timeline = localData.timeline.filter(item => item.id !== id);
  saveToBlob();
  renderTimeline();
  showStatus('타임라인이 삭제되었습니다', 'success');
}

async function deletePhoto(id) {
  if (!confirm('정말 삭제하시겠습니까?')) return;
  
  try {
    const photoItem = localData.photos.find(item => item.id === id);
    
    if (photoItem) {
      await fetch('/api/delete', {
        method: 'DELETE',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ url: photoItem.url })
      });
    }
    
    localData.photos = localData.photos.filter(item => item.id !== id);
    await saveToBlob();
    renderPhotos();
    showStatus('사진이 삭제되었습니다', 'success');
  } catch (error) {
    console.error('사진 삭제 에러:', error);
    showStatus('사진 삭제에 실패했습니다', 'error');
  }
}

function deleteLetterTo(id) {
  if (!confirm('정말 삭제하시겠습니까?')) return;
  localData.lettersTo = localData.lettersTo.filter(item => item.id !== id);
  saveToBlob();
  renderLettersTo();
  showStatus('편지가 삭제되었습니다', 'success');
}

function deleteLetterFrom(id) {
  if (!confirm('정말 삭제하시겠습니까?')) return;
  localData.lettersFrom = localData.lettersFrom.filter(item => item.id !== id);
  saveToBlob();
  renderLettersFrom();
  showStatus('편지가 삭제되었습니다', 'success');
}

function manageApp(appType) {
  if (!confirm(`${appType} 데이터를 모두 삭제하시겠습니까?`)) return;
  
  switch(appType) {
    case 'timeline':
      localData.timeline = [];
      renderTimeline();
      break;
    case 'photos':
      localData.photos = [];
      renderPhotos();
      break;
    case 'letters':
      localData.lettersTo = [];
      localData.lettersFrom = [];
      renderLettersTo();
      renderLettersFrom();
      break;
  }
  
  saveToBlob();
  showStatus(`${appType} 데이터가 초기화되었습니다`, 'success');
}

function exportData() {
  const dataStr = JSON.stringify(localData, null, 2);
  const blob = new Blob([dataStr], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  
  const a = document.createElement('a');
  a.href = url;
  a.download = `nyangkun-data-${new Date().toISOString().split('T')[0]}.json`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
  
  showStatus('데이터가 내보내기되었습니다', 'success');
}

function importData() {
  const fileInput = document.getElementById('import-file');
  if (!fileInput) return;
  
  const file = fileInput.files[0];
  
  if (!file) {
    showStatus('파일을 선택해주세요', 'error');
    return;
  }
  
  const reader = new FileReader();
  reader.onload = function(event) {
    try {
      const importedData = JSON.parse(event.target.result);
      if (confirm('기존 데이터를 모두 덮어쓰시겠습니까?')) {
        localData = { ...localData, ...importedData };
        saveToBlob();
        renderAll();
        showStatus('데이터가 가져오기되었습니다', 'success');
      }
    } catch (error) {
      showStatus('잘못된 파일 형식입니다', 'error');
    }
  };
  reader.readAsText(file);
}

document.getElementById('timeline-form').addEventListener('submit', (e) => {
  e.preventDefault();
  const newItem = {
    id: generateId(),
    date: document.getElementById('timeline-date').value,
    title: document.getElementById('timeline-title').value,
    content: document.getElementById('timeline-content').value,
    position: document.getElementById('timeline-position').value
  };
  
  localData.timeline.push(newItem);
  saveToBlob();
  document.getElementById('timeline-form').reset();
  renderTimeline();
  showStatus('타임라인이 추가되었습니다', 'success');
});

document.getElementById('photo-form').addEventListener('submit', async (e) => {
  e.preventDefault();
  const file = document.getElementById('photo-file').files[0];
  if (!file) {
    showStatus('사진을 선택해주세요', 'error');
    return;
  }

  try {
    showStatus('사진 업로드 중...', 'info');
    
    const url = await uploadToVercelBlob(file);
    
    const newItem = {
      id: generateId(),
      url: url,
      title: document.getElementById('photo-title').value,
      description: document.getElementById('photo-description').value,
      date: document.getElementById('photo-date').value
    };
    
    localData.photos.push(newItem);
    await saveToBlob();
    document.getElementById('photo-form').reset();
    renderPhotos();
    showStatus('사진이 추가되었습니다', 'success');
  } catch (error) {
    console.error('사진 업로드 에러:', error);
    showStatus('사진 업로드에 실패했습니다', 'error');
  }
});

document.getElementById('letter-to-form').addEventListener('submit', (e) => {
  e.preventDefault();
  const newItem = {
    id: generateId(),
    title: document.getElementById('letter-to-title').value,
    content: document.getElementById('letter-to-content').value,
    timestamp: getCurrentTimestamp()
  };
  
  localData.lettersTo.push(newItem);
  saveToBlob();
  document.getElementById('letter-to-form').reset();
  renderLettersTo();
  showStatus('편지가 작성되었습니다', 'success');
});

document.getElementById('letter-from-form').addEventListener('submit', (e) => {
  e.preventDefault();
  const newItem = {
    id: generateId(),
    name: document.getElementById('letter-from-name').value,
    message: document.getElementById('letter-from-content').value,
    timestamp: getCurrentTimestamp()
  };
  
  localData.lettersFrom.push(newItem);
  saveToBlob();
  document.getElementById('letter-from-form').reset();
  renderLettersFrom();
  showStatus('편지가 추가되었습니다', 'success');
});

renderAll();
loadLocalData();
loadChatLogs();
showStatus('시스템 초기화 완료', 'success');
</script>
</body>
</html>