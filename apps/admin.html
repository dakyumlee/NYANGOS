<!DOCTYPE html>

<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ëƒ¥ì¿¤OS ê´€ë¦¬ì</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

```
body {
  font-family: 'Press Start 2P', monospace;
  background: #0a0a0a;
  color: #4ade80;
  min-height: 100vh;
  image-rendering: pixelated;
  overflow-x: hidden;
}

.admin-container {
  background: 
    radial-gradient(circle at 25% 25%, rgba(74, 222, 128, 0.03) 0%, transparent 50%),
    radial-gradient(circle at 75% 75%, rgba(245, 158, 11, 0.03) 0%, transparent 50%),
    repeating-linear-gradient(90deg, transparent, transparent 2px, rgba(74, 222, 128, 0.01) 2px, rgba(74, 222, 128, 0.01) 4px);
  min-height: 100vh;
  padding: 20px;
}

.admin-header {
  background: linear-gradient(90deg, #111 0%, #1a1a1a 50%, #111 100%);
  border: 2px solid #4ade80;
  padding: 16px;
  margin-bottom: 24px;
  text-align: center;
  box-shadow: 0 0 20px rgba(74, 222, 128, 0.3), inset 0 0 20px rgba(74, 222, 128, 0.05);
}

.admin-title {
  font-size: 14px;
  color: #4ade80;
  text-shadow: 0 0 10px rgba(74, 222, 128, 0.5);
  margin-bottom: 8px;
}

.admin-subtitle {
  font-size: 8px;
  color: rgba(74, 222, 128, 0.7);
}

.admin-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
  gap: 24px;
  max-width: 1200px;
  margin: 0 auto;
}

.admin-section {
  background: rgba(0, 0, 0, 0.8);
  border: 2px solid #4ade80;
  padding: 20px;
  box-shadow: 0 0 15px rgba(74, 222, 128, 0.2), inset 0 0 15px rgba(74, 222, 128, 0.05);
}

.section-header {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 16px;
  padding-bottom: 8px;
  border-bottom: 1px solid rgba(74, 222, 128, 0.3);
}

.section-title {
  font-size: 10px;
  color: #86efac;
  text-shadow: 0 0 5px rgba(134, 239, 172, 0.3);
}

.form-group {
  margin-bottom: 16px;
}

.form-label {
  display: block;
  font-size: 7px;
  color: #4ade80;
  margin-bottom: 6px;
  text-transform: uppercase;
}

.form-input {
  width: 100%;
  background: rgba(0, 0, 0, 0.8);
  border: 2px solid #4ade80;
  color: #86efac;
  padding: 8px 12px;
  font-family: 'Press Start 2P', monospace;
  font-size: 7px;
  outline: none;
  transition: all 0.2s;
  box-shadow: 0 0 5px rgba(74, 222, 128, 0.2);
}

.form-input:focus {
  border-color: #f59e0b;
  color: #fbbf24;
  box-shadow: 0 0 10px rgba(245, 158, 11, 0.3);
}

.form-input::placeholder {
  color: rgba(74, 222, 128, 0.4);
}

.form-textarea {
  min-height: 80px;
  resize: vertical;
  line-height: 1.4;
}

.form-btn {
  background: rgba(0, 0, 0, 0.8);
  border: 2px solid #4ade80;
  color: #4ade80;
  padding: 8px 16px;
  font-size: 7px;
  cursor: pointer;
  font-family: 'Press Start 2P', monospace;
  transition: all 0.2s;
  box-shadow: 0 0 5px rgba(74, 222, 128, 0.2);
  margin-right: 8px;
  margin-bottom: 8px;
}

.form-btn:hover {
  background: #4ade80;
  color: #000000;
  transform: scale(1.05);
  box-shadow: 0 0 10px rgba(74, 222, 128, 0.4);
}

.form-btn.danger {
  border-color: #ef4444;
  color: #ef4444;
}

.form-btn.danger:hover {
  background: #ef4444;
  color: #000000;
}

.form-btn.warning {
  border-color: #f59e0b;
  color: #f59e0b;
}

.form-btn.warning:hover {
  background: #f59e0b;
  color: #000000;
}

.items-list {
  max-height: 300px;
  overflow-y: auto;
  margin-top: 16px;
}

.items-list::-webkit-scrollbar {
  width: 6px;
}

.items-list::-webkit-scrollbar-track {
  background: rgba(74, 222, 128, 0.1);
}

.items-list::-webkit-scrollbar-thumb {
  background: #4ade80;
  box-shadow: 0 0 3px rgba(74, 222, 128, 0.3);
}

.list-item {
  background: rgba(74, 222, 128, 0.05);
  border: 1px solid rgba(74, 222, 128, 0.2);
  padding: 12px;
  margin-bottom: 8px;
  transition: all 0.2s;
}

.list-item:hover {
  background: rgba(74, 222, 128, 0.1);
  border-color: rgba(74, 222, 128, 0.4);
}

.item-title {
  font-size: 8px;
  color: #86efac;
  margin-bottom: 4px;
}

.item-content {
  font-size: 6px;
  color: rgba(74, 222, 128, 0.8);
  line-height: 1.3;
  margin-bottom: 6px;
}

.item-meta {
  font-size: 5px;
  color: rgba(147, 51, 234, 0.8);
  margin-bottom: 8px;
}

.item-actions {
  display: flex;
  gap: 6px;
}

.status-indicator {
  position: fixed;
  top: 20px;
  right: 20px;
  background: rgba(0, 0, 0, 0.9);
  border: 2px solid #4ade80;
  padding: 8px 12px;
  font-size: 6px;
  color: #4ade80;
  box-shadow: 0 0 10px rgba(74, 222, 128, 0.3);
  z-index: 1000;
}

.status-indicator.success {
  border-color: #22c55e;
  color: #22c55e;
}

.status-indicator.error {
  border-color: #ef4444;
  color: #ef4444;
}

.iframe-container {
  margin-top: 16px;
  border: 2px solid rgba(74, 222, 128, 0.3);
  height: 300px;
  overflow: hidden;
}

.iframe-container iframe {
  width: 100%;
  height: 100%;
  border: none;
  background: rgba(5, 5, 5, 0.9);
}

.loading {
  text-align: center;
  color: rgba(74, 222, 128, 0.6);
  font-size: 7px;
  padding: 20px;
}

.loading-spinner {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 2px solid rgba(74, 222, 128, 0.3);
  border-top: 2px solid #4ade80;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-bottom: 8px;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.photo-preview {
  width: 60px;
  height: 60px;
  object-fit: cover;
  border: 1px solid rgba(74, 222, 128, 0.3);
  margin-right: 8px;
  display: inline-block;
}

@media (max-width: 768px) {
  .admin-grid {
    grid-template-columns: 1fr;
    gap: 16px;
  }
  
  .admin-container {
    padding: 10px;
  }
  
  .admin-section {
    padding: 16px;
  }
}
```

  </style>
</head>
<body>
  <div class="admin-container">
    <div class="status-indicator" id="status-indicator">ì‹œìŠ¤í…œ ì¤€ë¹„ì¤‘...</div>

```
<div class="admin-header">
  <div class="admin-title">ğŸ“‚ ëƒ¥ì¿¤OS ê´€ë¦¬ì í˜ì´ì§€</div>
  <div class="admin-subtitle">ì‹œìŠ¤í…œ ê´€ë¦¬ ë° ì½˜í…ì¸  í¸ì§‘</div>
</div>

<div class="admin-grid">
  <div class="admin-section">
    <div class="section-header">
      <div class="section-title">ğŸ“… ì—°ì•  íƒ€ì„ë¼ì¸ ê´€ë¦¬</div>
    </div>
    <form id="timeline-form">
      <div class="form-group">
        <label class="form-label">ë‚ ì§œ</label>
        <input type="text" class="form-input" id="timeline-date" placeholder="2024.03.11" required />
      </div>
      <div class="form-group">
        <label class="form-label">ì œëª©</label>
        <input type="text" class="form-input" id="timeline-title" placeholder="ì²« ë§Œë‚¨" required />
      </div>
      <div class="form-group">
        <label class="form-label">ë‚´ìš©</label>
        <textarea class="form-input form-textarea" id="timeline-content" placeholder="íŠ¹ë³„í•œ ìˆœê°„ì˜ ì´ì•¼ê¸°ë¥¼ ì ì–´ë³´ì„¸ìš”..."></textarea>
      </div>
      <div class="form-group">
        <label class="form-label">ìœ„ì¹˜</label>
        <input type="text" class="form-input" id="timeline-position" placeholder="50%" required />
      </div>
      <button type="submit" class="form-btn">ì¶”ê°€</button>
    </form>
    <div class="items-list" id="timeline-list">
      <div class="loading">
        <div class="loading-spinner"></div>
        íƒ€ì„ë¼ì¸ ë¡œë”©ì¤‘...
      </div>
    </div>
  </div>

  <div class="admin-section">
    <div class="section-header">
      <div class="section-title">ğŸ“¸ ì‚¬ì§„ ì—…ë¡œë“œ</div>
    </div>
    <form id="photo-form">
      <div class="form-group">
        <label class="form-label">ì‚¬ì§„ íŒŒì¼</label>
        <input type="file" class="form-input" id="photo-file" accept="image/*" required />
      </div>
      <div class="form-group">
        <label class="form-label">ì‚¬ì§„ ì œëª©</label>
        <input type="text" class="form-input" id="photo-title" placeholder="ìš°ë¦¬ì˜ ì¶”ì–µ" required />
      </div>
      <div class="form-group">
        <label class="form-label">ì„¤ëª…</label>
        <input type="text" class="form-input" id="photo-description" placeholder="ì§§ì€ ì„¤ëª…" />
      </div>
      <div class="form-group">
        <label class="form-label">ë‚ ì§œ</label>
        <input type="text" class="form-input" id="photo-date" placeholder="2024.04.01" required />
      </div>
      <button type="submit" class="form-btn">ì‚¬ì§„ ì—…ë¡œë“œ</button>
    </form>
    <div class="items-list" id="photo-list">
      <div class="loading">
        <div class="loading-spinner"></div>
        ì‚¬ì§„ ë¡œë”©ì¤‘...
      </div>
    </div>
  </div>

  <div class="admin-section">
    <div class="section-header">
      <div class="section-title">ğŸ§˜ ì˜¤ëŠ˜ì˜ ë¬µìƒ ê´€ë¦¬</div>
    </div>
    <form id="quote-form">
      <div class="form-group">
        <label class="form-label">ë¬µìƒ ë‚´ìš©</label>
        <textarea class="form-input form-textarea" id="quote-input" placeholder="ë§ˆìŒì— ì™€ë‹¿ëŠ” ë§ì”€ì„ ì…ë ¥í•˜ì„¸ìš”..." required></textarea>
      </div>
      <button type="submit" class="form-btn">ì–´ë¡ ì¶”ê°€</button>
    </form>
    <div class="items-list" id="quote-list">
      <div class="loading">
        <div class="loading-spinner"></div>
        ì–´ë¡ ë¡œë”©ì¤‘...
      </div>
    </div>
  </div>

  <div class="admin-section">
    <div class="section-header">
      <div class="section-title">ğŸ’Œ ëƒ¥ì¿¤ì—ê²Œ ì“°ëŠ” í¸ì§€</div>
    </div>
    <form id="letter-to-form">
      <div class="form-group">
        <label class="form-label">ì œëª©</label>
        <input type="text" class="form-input" id="letter-to-title" placeholder="ì‚¬ë‘í•˜ëŠ” ëƒ¥ì¿¤ì—ê²Œ" required />
      </div>
      <div class="form-group">
        <label class="form-label">ë‚´ìš©</label>
        <textarea class="form-input form-textarea" id="letter-to-content" placeholder="ëƒ¥ì¿¤ì—ê²Œ ì „í•˜ê³  ì‹¶ì€ ë§ˆìŒì„ ì¨ë³´ì„¸ìš”..." required></textarea>
      </div>
      <button type="submit" class="form-btn">í¸ì§€ ì‘ì„±</button>
    </form>
    <div class="items-list" id="letter-to-list">
      <div class="loading">
        <div class="loading-spinner"></div>
        í¸ì§€ ë¡œë”©ì¤‘...
      </div>
    </div>
  </div>

  <div class="admin-section">
    <div class="section-header">
      <div class="section-title">ğŸ“¨ ëƒ¥ì¿¤ì´ ë‚˜ì—ê²Œ ì“´ í¸ì§€</div>
    </div>
    <div class="iframe-container">
      <iframe id="letters-from-iframe" src=""></iframe>
    </div>
  </div>

  <div class="admin-section">
    <div class="section-header">
      <div class="section-title">ğŸ® ì•± ë¯¸ë¦¬ë³´ê¸°</div>
    </div>
    <div style="display: flex; gap: 8px; margin-bottom: 12px; flex-wrap: wrap;">
      <button class="form-btn" onclick="previewApp('chatbot')">ëƒ¥GPT</button>
      <button class="form-btn" onclick="previewApp('photos')">ì‚¬ì§„ì²©</button>
      <button class="form-btn" onclick="previewApp('quotes')">ëƒ¥ì¿¤í‚¤ìš°ê¸°</button>
      <button class="form-btn" onclick="previewApp('timeline')">íƒ€ì„ë¼ì¸</button>
      <button class="form-btn" onclick="previewApp('letters-from')">ë°›ì€í¸ì§€í•¨</button>
      <button class="form-btn" onclick="previewApp('letters-to')">í¸ì§€ì“°ê¸°</button>
    </div>
    <div class="iframe-container">
      <iframe id="app-preview-iframe" src=""></iframe>
    </div>
  </div>
</div>
```

  </div>

  <script type="module">
    let db = null;
    let storage = null;
    let isConnected = false;

    const apps = {
      'chatbot': `data:text/html;charset=utf-8,${encodeURIComponent(/* ì—¬ê¸°ì— chatbot HTML */)}`,
      'photos': `data:text/html;charset=utf-8,${encodeURIComponent(/* ì—¬ê¸°ì— photos HTML */)}`,
      'quotes': `data:text/html;charset=utf-8,${encodeURIComponent(/* ì—¬ê¸°ì— quotes HTML */)}`,
      'timeline': `data:text/html;charset=utf-8,${encodeURIComponent(/* ì—¬ê¸°ì— timeline HTML */)}`,
      'letters-from': `data:text/html;charset=utf-8,${encodeURIComponent(/* ì—¬ê¸°ì— letters-from HTML */)}`,
      'letters-to': `data:text/html;charset=utf-8,${encodeURIComponent(/* ì—¬ê¸°ì— letters-to HTML */)}`,
    };

    async function initFirebase() {
      try {
        const { initializeApp } = await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js");
        const { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc, serverTimestamp } = await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");
        const { getStorage, ref, uploadBytes, getDownloadURL, deleteObject } = await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-storage.js");

        const firebaseConfig = {
          apiKey: "AIzaSyBDXhlzkrKOhs-ewl4IDkPL5Oi2bIv0vTg",
          authDomain: "nyangos-fdbe6.firebaseapp.com",
          projectId: "nyangos-fdbe6",
          storageBucket: "nyangos-fdbe6.appspot.com",
          messagingSenderId: "349621507711",
          appId: "1:349621507711:web:2201669ae265cfbbfad14a"
        };

        const app = initializeApp(firebaseConfig);
        db = getFirestore(app);
        storage = getStorage(app);
        
        await getDocs(collection(db, 'timeline'));
        isConnected = true;
        showStatus('Firebase ì—°ê²° ì„±ê³µ', 'success');
        console.log('Firebase ì—°ê²° ì„±ê³µ');
        return true;
      } catch (error) {
        console.error('Firebase ì—°ê²° ì‹¤íŒ¨:', error);
        isConnected = false;
        showStatus('Firebase ì—°ê²° ì‹¤íŒ¨', 'error');
        return false;
      }
    }

    function showStatus(message, type = 'info') {
      const indicator = document.getElementById('status-indicator');
      indicator.textContent = message;
      indicator.className = `status-indicator ${type}`;
      
      setTimeout(() => {
        indicator.className = 'status-indicator';
        indicator.textContent = 'ì‹œìŠ¤í…œ ì¤€ë¹„ì™„ë£Œ';
      }, 3000);
    }

    async function loadTimeline() {
      if (!isConnected || !db) return;
      
      try {
        const { collection, getDocs } = await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");
        const snapshot = await getDocs(collection(db, 'timeline'));
        const list = document.getElementById('timeline-list');
        
        if (snapshot.empty) {
          list.innerHTML = '<div class="loading">ë“±ë¡ëœ íƒ€ì„ë¼ì¸ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
          return;
        }
        
        list.innerHTML = '';
        snapshot.forEach((docSnap) => {
          const data = docSnap.data();
          const item = document.createElement('div');
          item.className = 'list-item';
          item.innerHTML = `
            <div class="item-title">${data.date} - ${data.title}</div>
            <div class="item-content">${data.content}</div>
            <div class="item-meta">ìœ„ì¹˜: ${data.position}</div>
            <div class="item-actions">
              <button class="form-btn warning" onclick="editTimeline('${docSnap.id}')">ìˆ˜ì •</button>
              <button class="form-btn danger" onclick="deleteTimeline('${docSnap.id}')">ì‚­ì œ</button>
            </div>
          `;
          list.appendChild(item);
        });
      } catch (error) {
        console.error('íƒ€ì„ë¼ì¸ ë¡œë”© ì‹¤íŒ¨:', error);
        showStatus('íƒ€ì„ë¼ì¸ ë¡œë”© ì‹¤íŒ¨', 'error');
      }
    }

    async function loadPhotos() {
      if (!isConnected || !db) return;
      
      try {
        const { collection, getDocs } = await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");
        const snapshot = await getDocs(collection(db, 'photos'));
        const list = document.getElementById('photo-list');
        
        if (snapshot.empty) {
          list.innerHTML = '<div class="loading">ë“±ë¡ëœ ì‚¬ì§„ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
          return;
        }
        
        list.innerHTML = '';
        snapshot.forEach((docSnap) => {
          const data = docSnap.data();
          const item = document.createElement('div');
          item.className = 'list-item';
          item.innerHTML = `
            <img src="${data.url}" class="photo-preview" alt="${data.title}">
            <div style="display: inline-block; vertical-align: top;">
              <div class="item-title">${data.title}</div>
              <div class="item-content">${data.description}</div>
              <div class="item-meta">${data.date}</div>
              <div class="item-actions">
                <button class="form-btn danger" onclick="deletePhoto('${docSnap.id}')">ì‚­ì œ</button>
              </div>
            </div>
          `;
          list.appendChild(item);
        });
      } catch (error) {
        console.error('ì‚¬ì§„ ë¡œë”© ì‹¤íŒ¨:', error);
        showStatus('ì‚¬ì§„ ë¡œë”© ì‹¤íŒ¨', 'error');
      }
    }

    async function loadQuotes() {
      if (!isConnected || !db) return;
      
      try {
        const { collection, getDocs } = await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");
        const snapshot = await getDocs(collection(db, 'quotes'));
        const list = document.getElementById('quote-list');
        
        if (snapshot.empty) {
          list.innerHTML = '<div class="loading">ë“±ë¡ëœ ì–´ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
          return;
        }
        
        list.innerHTML = '';
        snapshot.forEach((docSnap) => {
          const data = docSnap.data();
          const item = document.createElement('div');
          item.className = 'list-item';
          item.innerHTML = `
            <div class="item-content">"${data.text}"</div>
            <div class="item-actions">
              <button class="form-btn danger" onclick="deleteQuote('${docSnap.id}')">ì‚­ì œ</button>
            </div>
          `;
          list.appendChild(item);
        });
      } catch (error) {
        console.error('ì–´ë¡ ë¡œë”© ì‹¤íŒ¨:', error);
        showStatus('ì–´ë¡ ë¡œë”© ì‹¤íŒ¨', 'error');
      }
    }

    async function loadLettersTo() {
      if (!isConnected || !db) return;
      
      try {
        const { collection, getDocs } = await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");
        const snapshot = await getDocs(collection(db, 'lettersToNyangkun'));
        const list = document.getElementById('letter-to-list');
        
        if (snapshot.empty) {
          list.innerHTML = '<div class="loading">ì‘ì„±ëœ í¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
          return;
        }
        
        list.innerHTML = '';
        snapshot.forEach((docSnap) => {
          const data = docSnap.data();
          const item = document.createElement('div');
          item.className = 'list-item';
          item.innerHTML = `
            <div class="item-title">${data.title}</div>
            <div class="item-content">${data.content.substring(0, 100)}...</div>
            <div class="item-meta">${data.timestamp?.toDate?.()?.toLocaleString('ko-KR') || 'No Date'}</div>
            <div class="item-actions">
              <button class="form-btn danger" onclick="deleteLetterTo('${docSnap.id}')">ì‚­ì œ</button>
            </div>
          `;
          list.appendChild(item);
        });
      } catch (error) {
        console.error('í¸ì§€ ë¡œë”© ì‹¤íŒ¨:', error);
        showStatus('í¸ì§€ ë¡œë”© ì‹¤íŒ¨', 'error');
      }
    }

    document.getElementById('timeline-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      if (!isConnected || !db) {
        showStatus('Firebase ì—°ê²°ì´ í•„ìš”í•©ë‹ˆë‹¤', 'error');
        return;
      }
      
      try {
        const { collection, addDoc } = await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");
        const data = {
          date: document.getElementById('timeline-date').value,
          title: document.getElementById('timeline-title').value,
          content: document.getElementById('timeline-content').value,
          position: document.getElementById('timeline-position').value
        };
        
        await addDoc(collection(db, 'timeline'), data);
        document.getElementById('timeline-form').reset();
        loadTimeline();
        showStatus('íƒ€ì„ë¼ì¸ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
      } catch (error) {
        console.error('íƒ€ì„ë¼ì¸ ì¶”ê°€ ì‹¤íŒ¨:', error);
        showStatus('íƒ€ì„ë¼ì¸ ì¶”ê°€ ì‹¤íŒ¨', 'error');
      }
    });

    document.getElementById('photo-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      if (!isConnected || !db || !storage) {
        showStatus('Firebase ì—°ê²°ì´ í•„ìš”í•©ë‹ˆë‹¤', 'error');
        return;
      }
      
      try {
        const { collection, addDoc } = await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");
        const { ref, uploadBytes, getDownloadURL } = await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-storage.js");
        
        const file = document.getElementById('photo-file').files[0];
        const title = document.getElementById('photo-title').value;
        const description = document.getElementById('photo-description').value;
        const date = document.getElementById('photo-date').value;

        if (!file) {
          showStatus('ì‚¬ì§„ì„ ì„ íƒí•´ì£¼ì„¸ìš”', 'error');
          return;
        }

        showStatus('ì‚¬ì§„ ì—…ë¡œë“œ ì¤‘...', 'info');
        
        const storageRef = ref(storage, `photos/${Date.now()}_${file.name}`);
        await uploadBytes(storageRef, file);
        const url = await getDownloadURL(storageRef);

        await addDoc(collection(db, 'photos'), { url, title, description, date });
        document.getElementById('photo-form').reset();
        loadPhotos();
        showStatus('ì‚¬ì§„ì´ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
      } catch (error) {
        console.error('ì‚¬ì§„ ì—…ë¡œë“œ ì‹¤íŒ¨:', error);
        showStatus('ì‚¬ì§„ ì—…ë¡œë“œ ì‹¤íŒ¨', 'error');
      }
    });

    document.getElementById('quote-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      if (!isConnected || !db) {
        showStatus('Firebase ì—°ê²°ì´ í•„ìš”í•©ë‹ˆë‹¤', 'error');
        return;
      }
      
      try {
        const { collection, addDoc } = await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");
        const text = document.getElementById('quote-input').value;
        if (!text) return;
        
        await addDoc(collection(db, 'quotes'), { text });
        document.getElementById('quote-form').reset();
        loadQuotes();
        showStatus('ì–´ë¡ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
      } catch (error) {
        console.error('ì–´ë¡ ì¶”ê°€ ì‹¤íŒ¨:', error);
        showStatus('ì–´ë¡ ì¶”ê°€ ì‹¤íŒ¨', 'error');
      }
    });

    document.getElementById('letter-to-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      if (!isConnected || !db) {
        showStatus('Firebase ì—°ê²°ì´ í•„ìš”í•©ë‹ˆë‹¤', 'error');
        return;
      }
      
      try {
        const { collection, addDoc, serverTimestamp } = await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");
        const title = document.getElementById('letter-to-title').value;
        const content = document.getElementById('letter-to-content').value;
        
        await addDoc(collection(db, 'lettersToNyangkun'), { 
          title, 
          content, 
          timestamp: serverTimestamp() 
        });
        document.getElementById('letter-to-form').reset();
        loadLettersTo();
        showStatus('í¸ì§€ê°€ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
      } catch (error) {
        console.error('í¸ì§€ ì‘ì„± ì‹¤íŒ¨:', error);
        showStatus('í¸ì§€ ì‘ì„± ì‹¤íŒ¨', 'error');
      }
    });

    window.deleteTimeline = async function(id) {
      if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
      
      try {
        const { doc, deleteDoc } = await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");
        await deleteDoc(doc(db, 'timeline', id));
        loadTimeline();
        showStatus('íƒ€ì„ë¼ì¸ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
      } catch (error) {
        console.error('ì‚­ì œ ì‹¤íŒ¨:', error);
        showStatus('ì‚­ì œ ì‹¤íŒ¨', 'error');
      }
    };

    window.deletePhoto = async function(id) {
      if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
      
      try {
        const { doc, deleteDoc } = await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");
        await deleteDoc(doc(db, 'photos', id));
        loadPhotos();
        showStatus('ì‚¬ì§„ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
      } catch (error) {
        console.error('ì‚­ì œ ì‹¤íŒ¨:', error);
        showStatus('ì‚­ì œ ì‹¤íŒ¨', 'error');
      }
    };

    window.deleteQuote = async function(id) {
      if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
      
      try {
        const { doc, deleteDoc } = await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");
        await deleteDoc(doc(db, 'quotes', id));
        loadQuotes();
        showStatus('ì–´ë¡ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
      } catch (error) {
        console.error('ì‚­ì œ ì‹¤íŒ¨:', error);
        showStatus('ì‚­ì œ ì‹¤íŒ¨', 'error');
      }
    };

    window.deleteLetterTo = async function(id) {
      if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
      
      try {
        const { doc, deleteDoc } = await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");
        await deleteDoc(doc(db, 'lettersToNyangkun', id));
        loadLettersTo();
        showStatus('í¸ì§€ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
      } catch (error) {
        console.error('ì‚­ì œ ì‹¤íŒ¨:', error);
        showStatus('ì‚­ì œ ì‹¤íŒ¨', 'error');
      }
    };

    window.previewApp = function(appName) {
      const iframe = document.getElementById('app-preview-iframe');
      if (apps[appName]) {
        iframe.src = apps[appName];
      } else {
        showStatus(`${appName} ì•±ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤`, 'error');
      }
    };

    document.addEventListener('DOMContentLoaded', async () => {
      console.log('ê´€ë¦¬ì í˜ì´ì§€ ì´ˆê¸°í™”');
      showStatus('ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì¤‘...', 'info');
      
      await initFirebase();
      
      if (isConnected) {
        loadTimeline();
        loadPhotos();
        loadQuotes();
        loadLettersTo();
        
        document.getElementById('letters-from-iframe').src = apps['letters-from'] || '';
      }
    });
  </script>

</body>
</html>