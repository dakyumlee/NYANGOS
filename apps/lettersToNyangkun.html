<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ëƒ¥ì¿¤ì—ê²Œ ì“°ëŠ” í¸ì§€ (ê´€ë¦¬ììš©)</title>
  <link rel="stylesheet" href="../style/base.css" />
  <link rel="stylesheet" href="../style/letter.css" />
</head>
<body>
  <div class="container">
    <h1>ğŸ’Œ ëƒ¥ì¿¤ì—ê²Œ ì“°ëŠ” í¸ì§€ (ê´€ë¦¬ììš©)</h1>
    <form id="letter-to-form">
      <input type="text" id="title" placeholder="ì œëª©" required />
      <textarea id="content" placeholder="ëƒ¥ì¿¤ì—ê²Œ ì „í•˜ê³  ì‹¶ì€ ë§" required></textarea>
      <button type="submit">ì‘ì„±</button>
    </form>
    <ul id="letter-to-list"></ul>
  </div>

  <script type="module">
    import { db } from "../script/firebase.js";
    import {
      collection,
      addDoc,
      getDocs,
      deleteDoc,
      doc,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";

    const toForm = document.getElementById("letter-to-form");
    const toList = document.getElementById("letter-to-list");
    const toRef = collection(db, "lettersToNyangkun");

    const renderToList = async () => {
      toList.innerHTML = "";
      const snap = await getDocs(toRef);
      snap.forEach(docu => {
        const li = document.createElement("li");
        li.innerHTML = `
          <strong>\${docu.data().title}</strong>
          <p>\${docu.data().content}</p>
          <button data-id="\${docu.id}" class="delete-to">ì‚­ì œ</button>
        `;
        toList.appendChild(li);
      });
    };

    toForm.addEventListener("submit", async e => {
      e.preventDefault();
      const title = document.getElementById("title").value;
      const content = document.getElementById("content").value;
      await addDoc(toRef, { title, content, timestamp: serverTimestamp() });
      toForm.reset();
      renderToList();
    });

    toList.addEventListener("click", async e => {
      if (e.target.classList.contains("delete-to")) {
        await deleteDoc(doc(db, "lettersToNyangkun", e.target.dataset.id));
        renderToList();
      }
    });

    renderToList();
  </script>
</body>
</html>
